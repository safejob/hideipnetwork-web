(()=>{"use strict";const e="function"==typeof atob,t="function"==typeof Buffer,n="function"==typeof TextDecoder?new TextDecoder:void 0,r=("function"==typeof TextEncoder&&new TextEncoder,Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=")),i=(e=>{let t={};return e.forEach(((e,n)=>t[e]=n)),t})(r),o=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,s=String.fromCharCode.bind(String),a="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),l=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),c=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,d=e=>{switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return s(55296+(t>>>10))+s(56320+(1023&t));case 3:return s((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return s((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},h=e=>e.replace(c,d),u=e=>{if(e=e.replace(/\s+/g,""),!o.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(3&e.length));let t,n,r,a="";for(let o=0;o<e.length;)t=i[e.charAt(o++)]<<18|i[e.charAt(o++)]<<12|(n=i[e.charAt(o++)])<<6|(r=i[e.charAt(o++)]),a+=64===n?s(t>>16&255):64===r?s(t>>16&255,t>>8&255):s(t>>16&255,t>>8&255,255&t);return a},f=e?e=>atob(l(e)):t?e=>Buffer.from(e,"base64").toString("binary"):u,p=t?e=>a(Buffer.from(e,"base64")):e=>a(f(e).split("").map((e=>e.charCodeAt(0)))),m=t?e=>Buffer.from(e,"base64").toString("utf8"):n?e=>n.decode(p(e)):e=>h(f(e)),b=e=>l(e.replace(/[-_]/g,(e=>"-"==e?"+":"/"))),y=e=>m(b(e)),g=y,M=self.Ultraviolet,w=g("JTNDZGl2JTIwY2xhc3MlM0QlMjJiYW4lMjIlM0UlMjAlM0NkaXYlMjBjbGFzcyUzRCUyMmJhbi10aXRsZSUyMiUzRU9wcy")+g("UyMH4lM0MlMkZkaXYlM0UlMjAlM0NkaXYlMjBjbGFzcyUzRCUyMmJhbi10ZXh0JTIyJTNFU2lyJTJDJTNDYiUyMHN0eWxlJTNEJTIyY29sb3IlM0ElMjAlMjNiODM5NDElM0IlMjIlMjBpZCUzRCUyMnJ")+g("lbW90ZUhvc3RuYW1lJTIyJTNFJTNDJTJGYiUzRSUyMHNlcnZlciUyMElQJTIwYWRkcmVzcyUyMGNvdWxkJTIwbm90JTIwYmUlMjBmb3VuZCUyMH4lM0MlMkZkaXYlM0UlMjAlM0NkaXYlMjBjbGFzcyUzRCUyMmFkcyUyMiUzRUFkdmVydG")+g("lzZW1lbnQlMjBwbGVhc2UlMjBjb250YWN0JTIwJTNDYiUyMHN0eWxlJTNEJTIyY29sb3IlM0ElMjAlMjNiODM5NDElM0IlMjIlM0UlMjAlM0NhJTIwc3R5bGUlM0QlMjJ0ZXh0LWRlY29yYXRpb24lM0ElMjBub25lJTNCY29sb3IlM0ElMjAlMjMyYTczYjAlM0IlMjIlMjBocmVmJTNEJTIyaHR0cHMlM0ElMkYlMkZ0Lm1lJTJGSmVzbW9yYSUyMiUzRSU0MHQubWUlMkZKZXNtb3JhJTNDJTJGYSUzRSUyMCUzQyUyRmIlM0UlMjAlM0MlMkZkaXYlM0UlMjAlM0MlMkZkaXYlM0U="),U=["cross-origin-embedder-policy","cross-origin-opener-policy","cross-origin-resource-policy","content-security-policy","content-security-policy-report-only","expect-ct","feature-policy","origin-isolation","strict-transport-security","upgrade-insecure-requests","x-content-type-options","x-download-options","x-frame-options","x-permitted-cross-domain-policies","x-powered-by","x-xss-protection"],x=["GET","HEAD"];class C extends M.EventEmitter{constructor(e=__uv$config){super(),e.bare||(e.bare="/bare/"),e.prefix||(e.prefix="/service/"),this.config=e;const t=(Array.isArray(e.bare)?e.bare:[e.bare]).map((e=>new URL(e,location).toString()));this.address=t[~~(Math.random()*t.length)],this.bareClient=new M.BareClient(this.address)}async fetch({request:e}){let t;try{if(!e.url.startsWith(location.origin+this.config.prefix))return await fetch(e);const n=new M(this.config,this.address);"function"==typeof this.config.construct&&this.config.construct(n,"service");const r=await n.cookie.db();n.meta.origin=location.origin,n.meta.base=n.meta.url=new URL(n.sourceUrl(e.url));const i=new J(e,this,n,x.includes(e.method.toUpperCase())?null:await e.blob());if("blob:"===n.meta.url.protocol&&(i.blob=!0,i.base=i.url=new URL(i.url.pathname)),e.referrer&&e.referrer.startsWith(location.origin)){const t=new URL(n.sourceUrl(e.referrer));(i.headers.origin||n.meta.url.origin!==t.origin&&"cors"===e.mode)&&(i.headers.origin=t.origin),i.headers.referer=t.href}const o=await n.cookie.getCookies(r)||[],s=n.cookie.serialize(o,n.meta,!1);i.headers["user-agent"]=navigator.userAgent,s&&(i.headers.cookie=s);const a=new T(i,null,null);if(this.emit("request",a),a.intercepted)return a.returnValue;t=i.blob?"blob:"+location.origin+i.url.pathname:i.url;const l=await this.bareClient.fetch(t,{headers:i.headers,method:i.method,body:i.body,credentials:i.credentials,mode:location.origin!==i.address.origin?"cors":i.mode,cache:i.cache,redirect:i.redirect}),c=new k(i,l),d=new T(c,null,null);if(this.emit("beforemod",d),d.intercepted)return d.returnValue;for(const e of U)c.headers[e]&&delete c.headers[e];if(c.headers.location&&(c.headers.location=n.rewriteUrl(c.headers.location)),"document"===e.destination){const e=c.headers["content-disposition"];if(!/\s*?((inline|attachment);\s*?)filename=/i.test(e)){const t=/^\s*?attachment/i.test(e)?"attachment":"inline",[n]=new URL(l.finalURL).pathname.split("/").slice(-1);c.headers["content-disposition"]=`${t}; filename=${JSON.stringify(n)}`}}if(c.headers["set-cookie"]&&(Promise.resolve(n.cookie.setCookies(c.headers["set-cookie"],r,n.meta)).then((()=>{self.clients.matchAll().then((function(e){e.forEach((function(e){e.postMessage({msg:"updateCookies",url:n.meta.url.href})}))}))})),delete c.headers["set-cookie"]),c.body)switch(e.destination){case"script":case"worker":{const t=[n.bundleScript,n.clientScript,n.configScript,n.handlerScript].map((e=>JSON.stringify(e))).join(",");c.body=`if (!self.__uv && self.importScripts) { ${n.createJsInject(this.address,this.bareClient.manfiest,n.cookie.serialize(o,n.meta,!0),e.referrer)} importScripts(${t}); }\n`,c.body+=n.js.rewrite(await l.text())}break;case"style":c.body=n.rewriteCSS(await l.text());break;case"iframe":case"document":(function(e,t=""){return"text/html"===(M.mime.contentType(t||e.pathname)||"text/html").split(";")[0]})(n.meta.url,c.headers["content-type"]||"")&&(c.body=n.rewriteHtml(await l.text(),{document:!0,injectHead:n.createHtmlInject(n.handlerScript,n.bundleScript,n.clientScript,n.configScript,this.address,this.bareClient.manfiest,n.cookie.serialize(o,n.meta,!0),e.referrer)}))}return"text/event-stream"===i.headers.accept&&(c.headers["content-type"]="text/event-stream"),crossOriginIsolated&&(c.headers["Cross-Origin-Embedder-Policy"]="require-corp"),this.emit("response",d),d.intercepted?d.returnValue:new Response(c.body,{headers:c.headers,status:c.status,statusText:c.statusText})}catch(n){return["document","iframe"].includes(e.destination)?(console.error(n),function(e,t,n){let r,i,o,s,a="";!function(e){return e instanceof Error&&"object"==typeof e.body}(e)?(r=500,i="Error processing your request",s="Internal Server Error",o=e instanceof Error?e.name:"UNKNOWN"):(r=e.status,i="Error communicating with the Bare server",s=e.body.message,o=e.body.code,a=e.body.id);return new Response(function(e,t,n,r,i,o,s){if("The specified host could not be resolved."===r)return function(e,t){const n=new URL(e),r=`remoteHostname.textContent = ${JSON.stringify(n.hostname)};bareServer.href = ${JSON.stringify(t)};uvHostname.textContent = ${JSON.stringify(location.hostname)};reload.addEventListener("click", () => location.reload());uvVersion.textContent = ${JSON.stringify("2.0.0")};`;return`\n    <!DOCTYPE html>\n<html lang="en">\n\n<head>\n    <meta charset="UTF-8">\n    <meta http-equiv="X-UA-Compatible" content="IE=edge">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <meta name="description" content="免费访问全球互联网，不需要梯子就可以访问全球互联网">\n    <meta name="keywords" content="hideipnetwork,github/hideipnetwork,proxy,online web,hnet">\n    <title>Error</title>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n            font-size: 16px;\n        }\n\n        /* ban */\n        .ban {\n            position: absolute;\n            width: 100%;\n            height: 100%;\n            top: 0;\n            left: 0;\n            background: rgba(0, 0, 0, 1);\n        }\n\n        .ban .ban-title {\n            position: absolute;\n            left: 50%;\n            top: 40%;\n            width: 100%;\n            text-align: center;\n            transform: translate(-50%, -60%);\n            color: #fff;\n            font-size: 5rem;\n            letter-spacing: 4px;\n        }\n\n        .ban .ban-text {\n            position: absolute;\n            left: 50%;\n            top: 50%;\n            width: 100%;\n            text-align: center;\n            transform: translate(-50%, -50%);\n            color: #fff;\n            font-size: 1rem;\n            letter-spacing: 2px;\n        }\n\n        .ban .ban-time {\n            position: absolute;\n            left: 50%;\n            top: 60%;\n            width: 100%;\n            text-align: center;\n            transform: translate(-50%, -40%);\n            color: #fff;\n            font-size: 5rem;\n        }\n        .ban .ads{\n            position: absolute;\n            top: 60%;\n            left: 50%;\n            transform: translate(-50%,-40%);\n            color: #fff;\n        }\n    </style>\n</head>\n\n<body>\n    ${decodeURIComponent(w)}\n    <script src="${"data:application/javascript,"+encodeURIComponent(r)}"><\/script>\n</body>\n\n</html>\n    `}(o,s);const a=`errorMessage.textContent =  ${JSON.stringify(r)};`;return`\n        <!DOCTYPE html>\n    <html lang="en">\n    \n    <head>\n        <meta charset="UTF-8">\n        <meta http-equiv="X-UA-Compatible" content="IE=edge">\n        <meta name="viewport" content="width=device-width, initial-scale=1.0">\n        <meta name="description" content="免费访问全球互联网，不需要梯子就可以访问全球互联网">\n        <meta name="keywords" content="hideipnetwork,github/hideipnetwork,proxy,online web,hnet">\n        <title>Error</title>\n        <style>\n            * {\n                margin: 0;\n                padding: 0;\n                box-sizing: border-box;\n                font-size: 16px;\n            }\n    \n            /* ban */\n            .ban {\n                position: absolute;\n                width: 100%;\n                height: 100%;\n                top: 0;\n                left: 0;\n                background: rgba(0, 0, 0, 1);\n            }\n    \n            .ban .ban-title {\n                position: absolute;\n                left: 50%;\n                top: 40%;\n                width: 100%;\n                text-align: center;\n                transform: translate(-50%, -60%);\n                color: #fff;\n                font-size: 5rem;\n                letter-spacing: 4px;\n            }\n    \n            .ban .ban-text {\n                position: absolute;\n                left: 50%;\n                top: 50%;\n                width: 100%;\n                text-align: center;\n                transform: translate(-50%, -50%);\n                color: #fff;\n                font-size: 1rem;\n                letter-spacing: 2px;\n            }\n    \n            .ban .ban-time {\n                position: absolute;\n                left: 50%;\n                top: 60%;\n                width: 100%;\n                text-align: center;\n                transform: translate(-50%, -40%);\n                color: #fff;\n                font-size: 5rem;\n            }\n            .ban .ads{\n                position: absolute;\n                top: 60%;\n                left: 50%;\n                transform: translate(-50%,-40%);\n                color: #fff;\n            }\n        </style>\n    </head>\n    \n    <body>\n    ${decodeURIComponent(w)}\n        <script src="${"data:application/javascript,"+encodeURIComponent(a)}"><\/script>\n    </body>\n    \n    </html>\n        `}(0,0,0,s,String(e),t,n),{status:r,headers:{"content-type":"text/html"}})}(n,t,this.address)):new Response(void 0,{status:500})}}static Ultraviolet=M}self.UVServiceWorker=C;class k{constructor(e,t){this.request=e,this.raw=t,this.ultraviolet=e.ultraviolet,this.headers={};for(const e in t.rawHeaders)this.headers[e.toLowerCase()]=t.rawHeaders[e];this.status=t.status,this.statusText=t.statusText,this.body=t.body}get url(){return this.request.url}get base(){return this.request.base}set base(e){this.request.base=e}}class J{constructor(e,t,n,r=null){this.ultraviolet=n,this.request=e,this.headers=Object.fromEntries(e.headers.entries()),this.method=e.method,this.address=t.address,this.body=r||null,this.cache=e.cache,this.redirect=e.redirect,this.credentials="omit",this.mode="cors"===e.mode?e.mode:"same-origin",this.blob=!1}get url(){return this.ultraviolet.meta.url}set url(e){this.ultraviolet.meta.url=e}get base(){return this.ultraviolet.meta.base}set base(e){this.ultraviolet.meta.base=e}}class T{#e;#t;constructor(e={},t=null,n=null){this.#e=!1,this.#t=null,this.data=e,this.target=t,this.that=n}get intercepted(){return this.#e}get returnValue(){return this.#t}respondWith(e){this.#t=e,this.#e=!0}}})();
//# sourceMappingURL=uv.sw.js.map